
# 物理层

## Concept

本节讲解物理层相关的基本概念。

物理层是网络体系结构中的最底层，其目的是尽可能屏蔽掉不同传输媒体和通信手段的差异，在连接各计算机的传输媒体上传输数据比特流，为数据链路层提供一个同一的数据传输服务。

为此，物理层确定了与传输介质的接口相关的四个特性：机械特性、电气特性、功能特性、过程特性。

数据是传送信息的实体，信号则是数据的电气或电磁表现，是数据在传输过程中的存在形式。

在通信系统中，常用一个固定时长的信号波形表示一个 k 进制数，这个时长内的信号称为**k 进制码元**，时长称为**码元宽度（or 信号周期）**。

一个码元可以携带若干比特信息，例如一个信号周期内可能出现四种信号，则每个信号对应一个 4 进制数（2 bit）。

数据与信号都有*模拟*和*数字*一分，对应了连续和离散两种表示方式。

- 以模拟信号来传送信息的通信方式称为模拟通信，传输模拟信号的通信系统称为模拟通信系统
- 以数字信号来传送信息的通信方式称为数字通信，传输数字信号的通信系统称为数字通信系统

模拟信号和数字信号在传输过程中可以相互变换，即 A/D 和 D/A。

从通信双方信息的交互方式看，分为三种基本方式：

- **单工通信 Simplex:** 只有一个方向的通信且没有反方向的交互，例如广播
- **半双工通信 Half-Duplex:** 通信双方都可以发送或接收信息，但任何一方都不能同时发送和接收信息
- **全双工通信 Full-Duplex:** 通信双方都可以同时发送和接收信息 

!!! note "单工只需要一个信道，而半双工和全双工都需要两个信道"

## 信道极限容量

任何实际的信道都不是理想的，信号在信道上传输不可避免地会产生失真。只要接收端能够从失真的信号波形中识别出原来的信号，这种失真就对通信质量没有影响。

<font style="font-weight: 1000;font-size: 20px" color="orange">奈氏准则</font>

信号中的高频分量往往会在传输中衰减，导致接收端不能分清码元之间的界限，这种现象称为**码间串扰**。

奈奎斯特定理规定，在**理想（没有噪声，带宽有限）信道**中，为了避免码间串扰，极限码元传输速率应为 $2W$ 波特，其中 $W$ 为信道的频率带宽，单位为 Hz。

若用 $V$ 表示码元的离散电平数量，则该码元对应的二进制为个数为 $\log_2 V$，那么奈氏准则下的极限数据传输速率为：

$$
2W \log_2 V \;\;\; (b/s)
$$

奈氏准则给出了码元传输速率的上限，但未对一个码元最多可以表示多少比特给出限制，因此要提高数据传输速率可以设法使每个码元携带更多比特的信息量

<font style="font-weight: 1000;font-size: 20px" color="orange">香农定理</font>

实际的信道存在随机噪声，香农定理给出了带宽受限且存在高斯噪声干扰的信道的极限数据传输速率：

$$
W\log_2 (1+ S / N)\;\;\; (b/s)
$$

其中 $S$ 为信道内信号的平均功率，$N$ 为信道内高斯噪声的功率。我们称 $S / N$ 为**信噪比**，它有无单位记法和分贝记法两种形式：

- 当采用无单位记法时，信噪比 $= S/ N$
- 当采用分贝记法时，信噪比 $=10\log_{10} (S / N)$

!!! example "例如当 $S/ N=1000$ 时，信噪比等于 30 dB"

根据香农定理，我们直到只要信息传输速率低于信道的极限传输速率，就能找到某种方法实现无差错的控制。不过实际信道能达到的传输速率要比该极限信息传输速率低不少。

## 编码与调制

将数据转换为数字信号的过程称为**编码**，将数据转换为模拟信号的过程称为**调制**。

### 编码

编码决定了具体用什么样的数字信号表示 0 和 1，常用的数字数据编码有如下几种：

![[cn_topic1_1.png]]

- **归零编码 RZ:** 用高电平表示 1，低电平表示 0；每个码元中间均跳变回零电平，接收方据此调整时钟，以达到自同步机制
	- 因为归零占用带宽，传输效率收到影响
- **非归零编码 NRZ:** 与 RZ 区别在于不用归零，一个时钟全部用来传输数据，效率最高，但存在同步问题
	- 同步问题可通过双方都带有时钟线解决
- **反向非归零编码 NRZI:** 也叫逢 0 变化 NRZ，用电平的跳变表示 0，电平保持不变表示 1
	- 这种编码集成了前两种编码的优点，既能传输时钟信号，又尽量不损失系统带宽
	- USB 2.0 就采用了 NRZI 编码
- **曼彻斯特编码:** 每个码元中间都会发生跳变，且二进制数据跳变时电平保持不变
	- 可以用向下跳变表示 1，向上跳变表示 0；或者相反的规定
	- 码元中间的电平跳变及作为时钟信号用于同步，也作为数据信号表示数据
	- 标准以太网采用了曼彻斯特编码
- **差分曼彻斯特编码:** 每个码元中间都会发生跳变，每个码元开始处无跳变表示 1，有跳变表示 0
	- 码元中间的电平跳变仅表示时钟信号，而不表示数据
	- 由于具有更强的抗干扰能力，差分曼彻斯特编码广泛用于宽带高速网中

除此之外，课件中还介绍了 4B/5B 编码方案，它使用 5-bit 的码元表示 4-bit 的数据，具体的映射如下：

|Data (4B)|Codeword (5B)|Data (4B)|Codeword (5B)|
|---|---|---|---|
|0000|11110|1000|10010|
|0001|01001|1001|10011|
|0010|10100|1010|10110|
|0011|10101|1011|10111|
|0100|01010|1100|11010|
|0101|01011|1101|11011|
|0110|01110|1110|11100|
|0111|01111|1111|11101|

其特点是 5 比特码组中至少包含两个 1，至多包含 3 个 0，避免长时间不跳变，以此达到确保可以恢复时钟并进行同步的效果。

为了增强可靠性，4B/5B 编码额外使用了 1-bit 编码开销，因此它的编码效率为 $\frac{4}{5}=80\%$。

**【Example】** 在快速以太网中，如果数据传输率要达到 100Mbps，采用 4B/5B 编码需要多少波特率？

$$
\text{编码后的信号波特率}=\text{数据传输率} / \text{编码效率} = 125 M\ Baud
$$

!!! info "曼彻斯特编码的编码效率为 50%，因为它用 2-bit 码元表示 1-bit 数据"

将模拟数据编码为数字信号，主要包括采样、量化、编码三个步骤，此处不是重点。

### 调制

发送端将数字信号转换为模拟信号，而接收端将模拟信号还原为数字信号，分别对应了调制解调器的**调制和解调**的过程。调幅、调频、调相是数字调制的三种方式：

![[cn_topic1_3.png]]

三种调制技术分别对应了载波 $A\sin (\omega t +\phi)$ 的幅度、频率和相位：

- **调幅 AM / 幅移键控 ASK** 通过改变载波的振幅表示数字信号 1 或 0，容易实现但抗干扰能力差
- **调频 FM / 频移键控 FSK** 通过改变载波的频率表示数字信号 1 和 0，容易实现且抗干扰能力强，应用广泛
- **调相 PM / 相移键控 PSK** 通过改变载波的相位表示数字信号 1 和 0，抗干扰能力强但不容易实现

## 传输介质

传输介质是发送器和接收器之间的物理通路可分为两大类：

- **导引型传输介质** 指电磁波被导向沿着某一媒体传输
	- 双绞线，同轴电缆，电力线和光纤等
- **非导引型传输介质** 指电磁波在大气层、外层空间或海洋中进行的无线传播
	- 短波传输，地面微波，卫星微波，广播传输等

### 导引型传输介质

<font style="font-weight: 1000;font-size: 20px" color="orange">双绞线</font>

双绞线是最常用的传输介质，由两根采用一定规则并排绞合、相互绝缘的铜导线组成。通常多跟双绞线会再被绞合，形成电缆状。

!!! note "绞合是为了减少对相邻导线的电磁干扰"

双绞线价格偏移，同时适用于模拟传输和数字传输，通信距离一般为几千米到数十千米。双绞线的带宽取决于铜线的粗细和传输的距离。

<font style="font-weight: 1000;font-size: 20px" color="orange">同轴电缆</font>

同轴电缆由内导体、绝缘层、外导体屏蔽层和绝缘保护套层构成：

![[cn_topic1_4.png]]

按照特性阻抗的不同，可分为**基带同轴电缆（50Ω）**和**宽带同轴电缆（75Ω）**

- 基带同轴用于传送基带信号，距离可达 1km，传输速率为 10Mbps
- 宽带同轴是有线电视的标准传输电缆，传送频分复用的宽带信号，信号频率可达 300-400 MHz，距离可达 100km

同轴电缆具有寿命长、容量大、传输稳定、外界干扰小、维护方便等特点，但现在局域网领域基本都采用双绞线都作为传输介质。

<font style="font-weight: 1000;font-size: 20px" color="orange">光纤</font>

光纤通信利用光导纤维可以传递光脉冲进行通信，有光脉冲则为 1，无光脉冲则为 0。

!!! info "可见光的频率数量级为 $10^8$ Hz，因此光纤的带宽极大"

光纤有纤芯和包层构成，包层较纤芯具有较低的折射率，光纤利用了光的全反射特性进行光脉冲信号传输。

![[cn_topic1_5.png]]

多模光纤允许让多条光线以不同角度入射同一根光纤，其光脉冲损耗更高，带宽较窄，适用于小容量近距离传输。

而单模光纤的直径小到只有一个光的波长，光线在其中以直线向前传播，不产生多次反射。单模光纤的制作成本较高，但是衰减很小，适合远距离传输。

处理带宽非常大的优点，光纤通信还具有以下特点：

1. 传输损耗小，中继距离长
2. 抗雷电和电磁干扰性能好
3. 不易被窃听或截取
4. 体积小，重量轻

### 无线传输介质

<font style="font-weight: 1000;font-size: 20px" color="orange">无线电波</font>

无线电波具有较强的穿透能力，可以传输很长的距离。由于无线电波信号向所有方向散播，有效距离内的接收设备无需对准某个方向就可以进行通信连接。

目前广泛应用于通信领域，例如无线手机通信、无线局域网（WLAN）等。

<font style="font-weight: 1000;font-size: 20px" color="orange">微波、红外线、激光</font>

微波、红外线、激光是目前主要使用的三种高带宽无线通信，他们具有很强的指向性，要求发送方和接收方之间有一条视线通路。

卫星通信利用地球同步卫星作为中继站来转发微波信号，可以突破地面微波通信距离的限制。卫星通信的优点是通信容量大、距离远、覆盖广，缺点是保密性差，端到端传播时延长。

## 多路复用

信道资源是有限的，实际网络中，多对用户往往需要利用相同的信道资源传输信息。

**复用（multiplexing）技术**允许用户使用一个共享信道进行通信，提高了利用率。

<font style="font-weight: 1000;font-size: 20px" color="orange">时分复用 TDM</font>

Time Division Multiplexing 将信道的传输时间划分为一段段等长的时间片，称为 TDM 帧，每个用户在每个 TDM 帧中占用固定序号的时隙。

![[cn_topic1_6.png]]

当用户在某段时间无数据传输，其他用户也无法使用这个暂时空闲的线路资源，所以时分复用的信道利用率不高。

另外有一种统计时分复用 Statistic TDM，它允许动态分配时隙，当有用户有数据需要传送时才会分配到时隙。

<font style="font-weight: 1000;font-size: 20px" color="orange">频分复用 FDM</font>

Frequency Division Multiplexing 将信道的总频划分为多个子信道，每对用户使用其中一个子信道进行通信。所有用户在同一时间占用不同频带资源，相邻信道之间还要加入隔离频带，防止相互干扰。

![[cn_topic1_7.png]]

频分复用的优点在于充分利用了介质的带宽，系统效率较高，实现也较容易。

<font style="font-weight: 1000;font-size: 20px" color="orange">波分复用 WDM</font>

Wavelength Division Multiplexing 即光的频分复用，利用光的不同波长。它在一根光纤种传输多种波长的光信号，最后用光分器将各路波长分解出来。

<font style="font-weight: 1000;font-size: 20px" color="orange">码分复用 CDM / 码分多址 CDMA</font>

Code Division Multiplexing / Code Division Multiple Access 采用不同编码来区分各路原始信号，与前三者不同，它既共享信道，又共享时间。

它为每个站点分配一个指定的 m 位码片序列，并且保证：

- 不同站的码片序列相互正交，规格化内积为 0
	- $S\cdot T= \frac{1}{m} \sum_{i=1}^m S_i T_i = 0$
- 同一站码片序列自身的规格化内积为 1
	- $S\cdot S = \frac{1}{m}\sum_{i=1}^m S_i S_i = \frac{1}{m}\sum_{i=1} ^m (\pm 1)^2 = 1$

这样多个站点的码片在公共信道线性叠加后，可以通过规格化内积进行数据分离。

如果规格化内积结果为 1，则说明该站点发送了信号 1；如果规格化内积为 -1，则说明该站点发送了信号 0；如果规格化内积为 0，则说明该站点没有发送信息。

## 物理层设备

**中继器**和**集线器**是物理层的主要设备。使用中继器和集线器连接的几个网段仍是一个局域网。

中继器的主要功能是放大、整形并转发信号，以消除信号经过一长段电缆后产生的失真和衰减，使信号的波形和强度达到所需的要求。

集线器本质是一个多端口的中继器，当一个端口接收到数据信号后，集线器对该信号进行整形放大，然后转发到其它所有处于工作状态的端口上（除了输入端口）。

根据集线器的工作原理，我们不难看出如果同时存在两个或以上端口输入，则输出时将发生冲突，因此集线器只能在半双工状态下工作。